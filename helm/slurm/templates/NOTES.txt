********************************************************************************

                                 SSSSSSS
                                SSSSSSSSS
                                SSSSSSSSS
                                SSSSSSSSS
                        SSSS     SSSSSSS     SSSS
                       SSSSSS               SSSSSS
                       SSSSSS    SSSSSSS    SSSSSS
                        SSSS    SSSSSSSSS    SSSS
                SSS             SSSSSSSSS             SSS
               SSSSS    SSSS    SSSSSSSSS    SSSS    SSSSS
                SSS    SSSSSS   SSSSSSSSS   SSSSSS    SSS
                       SSSSSS    SSSSSSS    SSSSSS
                SSS    SSSSSS               SSSSSS    SSS
               SSSSS    SSSS     SSSSSSS     SSSS    SSSSS
          S     SSS             SSSSSSSSS             SSS     S
         SSS            SSSS    SSSSSSSSS    SSSS            SSS
          S     SSS    SSSSSS   SSSSSSSSS   SSSSSS    SSS     S
               SSSSS   SSSSSS   SSSSSSSSS   SSSSSS   SSSSS
          S    SSSSS    SSSS     SSSSSSS     SSSS    SSSSS    S
    S    SSS    SSS                                   SSS    SSS    S
    S     S                                                   S     S
                SSS
                SSS
                SSS
                SSS
 SSSSSSSSSSSS   SSS   SSSS       SSSS    SSSSSSSSS   SSSSSSSSSSSSSSSSSSSS
SSSSSSSSSSSSS   SSS   SSSS       SSSS   SSSSSSSSSS  SSSSSSSSSSSSSSSSSSSSSS
SSSS            SSS   SSSS       SSSS   SSSS        SSSS     SSSS     SSSS
SSSS            SSS   SSSS       SSSS   SSSS        SSSS     SSSS     SSSS
SSSSSSSSSSSS    SSS   SSSS       SSSS   SSSS        SSSS     SSSS     SSSS
 SSSSSSSSSSSS   SSS   SSSS       SSSS   SSSS        SSSS     SSSS     SSSS
         SSSS   SSS   SSSS       SSSS   SSSS        SSSS     SSSS     SSSS
         SSSS   SSS   SSSS       SSSS   SSSS        SSSS     SSSS     SSSS
SSSSSSSSSSSSS   SSS   SSSSSSSSSSSSSSS   SSSS        SSSS     SSSS     SSSS
SSSSSSSSSSSS    SSS    SSSSSSSSSSSSS    SSSS        SSSS     SSSS     SSSS

********************************************************************************

CHART NAME: {{ .Chart.Name }}
CHART VERSION: {{ .Chart.Version }}
APP VERSION: {{ .Chart.AppVersion }}

{{ .Chart.Name }} has been installed. Check its status by running:
  $ kubectl --namespace={{ include "slurm.namespace" $ }} get pods -l helm.sh/chart={{ include "slurm.chart" $ }} --watch

{{- range $key, $loginset := $.Values.loginsets -}}
{{- if $loginset.enabled }}
{{- $name := printf "%s-%s" (include "slurm.login.name" $) $key }}

ssh via the Slurm login ({{ $name }}) service:
  {{- if eq ($loginset | dig "service" "spec" "type" "" | lower) ("LoadBalancer" | lower) }}
  $ SLURM_LOGIN_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ $name }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')"
  {{- else if eq ($loginset | dig "service" "spec" "type" "" | lower) ("ExternalName" | lower) }}
  $ SLURM_LOGIN_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ $name }} -o jsonpath='{.spec.externalName}')"
  {{- else }}
  $ SLURM_LOGIN_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ $name }} -o jsonpath='{.spec.clusterIP}')"
  {{- end }}{{- /* if eq ($loginset | dig "service" "spec" "type" "" | lower) ("LoadBalancer" | lower) */}}
  $ ssh -p {{ $loginset | dig "service" "port" "22" }} $SLURM_LOGIN_IP
{{- end }}{{- /* $loginset.enabled */}}
{{- end }}{{- /* range $key, $loginset := $.Values.loginsets */}}

{{- if ne (.Values.controller | dig "service" "spec" "type" "None" | lower) ("None" | lower) }}

The Slurm controller service:
  {{- if eq (.Values.controller | dig "service" "spec" "type" "" | lower) ("LoadBalancer" | lower) }}
  $ SLURM_CONTROLLER_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ include "slurm.controller.name" . }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')"
  {{- else if eq (.Values.controller | dig "service" "spec" "type" "" | lower) ("ExternalName" | lower) }}
  $ SLURM_CONTROLLER_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ include "slurm.controller.name" . }} -o jsonpath='{.spec.externalName}')"
  {{- else }}
  $ SLURM_CONTROLLER_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ include "slurm.controller.name" . }} -o jsonpath='{.spec.clusterIP}')"
  {{- end }}{{- /* if eq (.Values.controller | dig "service" "spec" "type" "" | lower) ("LoadBalancer" | lower) */}}
  $ SLURM_CONF_SERVER=$SLURM_CONTROLLER_IP:{{ .Values.controller | dig "service" "port" "6817" }}

Learn more about slurmctld:
  - Overview: https://slurm.schedmd.com/slurmctld.html
  - Configless: https://slurm.schedmd.com/configless_slurm.html
{{- end }}{{- /* if ne (.Values.controller | dig "service" "spec" "type" "None" | lower) ("None" | lower) */}}

{{- if ne (.Values.restapi | dig "service" "spec" "type" "None" | lower) ("None" | lower) }}

curl the Slurm restapi service:
  {{- if eq (.Values.restapi | dig "service" "spec" "type" "" | lower) ("LoadBalancer" | lower) }}
  $ SLURM_RESTAPI_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ include "slurm.restapi.name" . }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')"
  {{- else if eq (.Values.restapi | dig "service" "spec" "type" "" | lower) ("ExternalName" | lower) }}
  $ SLURM_RESTAPI_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ include "slurm.restapi.name" . }} -o jsonpath='{.spec.externalName}')"
  {{- else }}
  $ SLURM_RESTAPI_IP="$(kubectl get services -n {{ include "slurm.namespace" $ }} {{ include "slurm.restapi.name" . }} -o jsonpath='{.spec.clusterIP}')"
  {{- end }}{{- /* if eq (.Values.restapi | dig "service" "spec" "type" "" | lower) ("LoadBalancer" | lower) */}}
  $ curl -H "X-SLURM-USER-TOKEN: auth/none" http://${SLURM_RESTAPI_IP}:{{ .Values.restapi | dig "service" "port" "6820" }}/openapi/v3

Learn more about slurmrestd:
  - Overview: https://slurm.schedmd.com/rest.html
  - Quickstart: https://slurm.schedmd.com/rest_quickstart.html
  - Documentation: https://slurm.schedmd.com/rest_api.html
{{- end }}{{- /* if ne (.Values.restapi | dig "service" "spec" "type" "None" | lower) ("None" | lower) */}}

Learn more about Slurm:
  - Overview: https://slurm.schedmd.com/overview.html
  - Quickstart: https://slurm.schedmd.com/quickstart.html
  - Documentation: https://slurm.schedmd.com/documentation.html
  - Support: https://www.schedmd.com/slurm-support/our-services/
  - File Tickets: https://support.schedmd.com/

Learn more about Slinky:
  - Overview: https://www.schedmd.com/slinky/why-slinky/
  - Documentation: https://slinky.schedmd.com
